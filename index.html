<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link
        href="https://fonts.googleapis.com/css2?family=Balthazar&amp;family=Libertinus+Sans:ital,wght@0,400;0,700;1,400&amp;family=Major+Mono+Display&amp;family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&amp;family=Workbench&amp;display=swap"
        rel="stylesheet">
    <style>
        body {
            display: flex;
            justify-content: center;
            background-color: black;
            color: white;

        }

        #statbox {
            width: 100%;
        }

        .h0 {
            color: white;
            font-size: 63px;
            font-family: "Balthazar";
            text-align: center;
        }

        .h1 {
            color: white;
            font-size: 42px;
            font-family: "Balthazar";
            user-select: none;
        }

        .h3 {
            color: white;
            font-size: 21px;
            font-family: "Balthazar";
            user-select: none;
        }

        .box {
            display: flex;
            margin: 10px;
            align-items: flex-start;
            padding-left: 30px;
            padding-right: 30px;
        }

        .stat {
            border: 2px solid;
            padding: 12px;
            border-radius: 3px;
            margin-bottom: 8px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Balthazar";
            flex-wrap: wrap;
            user-select: none;
            flex-direction: column;
        }

        .statT,
        .statV {
            font-size: 32px;
        }

        .title {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }

        .tools {
            font-size: 30px;
        }

        .tools span {
            padding-left: 20px;
            padding-right: 20px;
        }

        .tools span:hover {
            background-color: white;
            color: black;
            cursor: pointer;
        }

        .statwrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        #cpc:hover {
            background: white;
            color: black;
            cursor: pointer;
        }

        .substat {
            width: 100%;
            font-size: 18px;
            margin-bottom: 6px;
        }

        .substat>div:hover {
            color: black;
            background-color: white;
        }

        .substat>div {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <div id="statbox">
        <div class="h0" id="name" contenteditable="">CHARACTER NAME</div>
        <div class="h3" style="text-align: center;">Stats left for distribution: <span id="stat">25</span></div>
        <div class="h3">Cerebrophysical Coordination: <span id="cpc">1</span></div>
        <div class="h3">Active Time: <span id="activeTime">1</span> second(s)</div>
        <div class="h3">Health: <span id="health">1</span></div>
        <div class="box" style="justify-content: center;">
            <div class="box" style="width: 50%; flex-wrap: wrap; justify-content: center;">
                <div class="h1" style="text-align: center;">PHYSICS <span id="pavg">1</span></div>
                <div class="statwrapper">
                    <div class="stat">
                        <div class="title">
                            <div class="statT">MUSCLOSKELETAL</div>
                            <div class="statV" id="msk">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('msk')">+</span> <span
                                onclick="valAdd('msk', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-msk">3</span></div>
                        <div class="substat" skill="msk">
                            <div skillid='1'>Force<span id='smsk1'>0</span></div>
                            <div skillid='2'>Flexibility<span id='smsk2'>0</span></div>
                            <div skillid='3'>Primal Drive<span id='smsk3'>0</span></div>
                            <div skillid='4'>Proprioception<span id='smsk4'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">REFLEXES</div>
                            <div class="statV" id="ref">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('ref')">+</span> <span
                                onclick="valAdd('ref', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-ref">3</span></div>
                        <div class="substat" skill="ref">
                            <div skillid='1'>Reaction Speed<span id='sref1'>0</span></div>
                            <div skillid='2'>Primal Memory<span id='sref2'>0</span></div>
                            <div skillid='3'>Cognitive Override<span id='sref3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">CALORIMETRICS</div>
                            <div class="statV" id="cal">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('cal')">+</span> <span
                                onclick="valAdd('cal', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-cal">3</span></div>
                        <div class="substat" skill="cal">
                            <div skillid='1'>Energy Budget<span id='scal1'>0</span></div>
                            <div skillid='2'>Starvation<span id='scal2'>0</span></div>
                            <div skillid='3'>Insomnia<span id='scal3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">IMMUNE SYSTEM</div>
                            <div class="statV" id="imm">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('imm')">+</span> <span
                                onclick="valAdd('imm', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-imm">3</span></div>
                        <div class="substat" skill="imm">
                            <div skillid='1'>Leukocytic Panopticon<span id='simm1'>0</span></div>
                            <div skillid='2'>Mithridatist Clade<span id='simm2'>0</span></div>
                            <div skillid='3'>Phagocytocrisis<span id='simm3'>0</span></div>
                        </div>
                    </div>
                </div>
                <div class="stat">
                    <div class="title">
                        <div class="statT">HOMEOSTASIS</div>
                        <div class="statV" id="hom">1</div>
                    </div>
                    <div class="tools"><span onclick="valAdd('hom')">+</span> <span onclick="valAdd('hom', -1)">-</span>
                    </div>
                    <div class="point">Skill points remaining: <span id="s-hom">3</span></div>
                    <div class="substat" skill="hom">
                        <div skillid='1'>Renin-Angiotensin System<span id='shom1'>0</span></div>
                        <div skillid='2'>Em-Receptor<span id='shom2'>0</span></div>
                        <div skillid='3'>Thermoregulation<span id='shom3'>0</span></div>
                    </div>
                </div>
            </div>
            <div class="box" style="width: 50%; flex-wrap: wrap; justify-content: center;">
                <div class="h1" style="text-align: center;">CEREBRUM <span id="cavg">1</span></div>
                <div class="statwrapper">
                    <div class="stat">
                        <div class="title">
                            <div class="statT">LINGUISTIC FACTORY</div>
                            <div class="statV" id="lif">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('lif')">+</span> <span
                                onclick="valAdd('lif', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-lif">3</span></div>
                        <div class="substat" skill="lif">
                            <div skillid='1'>Sentence Formation<span id='slif1'>0</span></div>
                            <div skillid='2'>Mimicry<span id='slif2'>0</span></div>
                            <div skillid='3'>Delivery<span id='slif3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">DEDUCTION</div>
                            <div class="statV" id="ded">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('ded')">+</span> <span
                                onclick="valAdd('ded', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-ded">3</span></div>
                        <div class="substat" skill="ded">
                            <div skillid='1'>Estimation<span id='sded1'>0</span></div>
                            <div skillid='2'>Statistics<span id='sded2'>0</span></div>
                            <div skillid='3'>Autorectifier<span id='sded3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">NEUROCHEMISTRY</div>
                            <div class="statV" id="nch">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('nch')">+</span> <span
                                onclick="valAdd('nch', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-nch">3</span></div>
                        <div class="substat" skill="nch">
                            <div skillid='1'>Cortical Homeostasis<span id='snch1'>0</span></div>
                            <div skillid='2'>Glandular Affinity<span id='snch2'>0</span></div>
                            <div skillid='3'>Addiction<span id='snch3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">SENSORY PROCESSING</div>
                            <div class="statV" id="spc">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('spc')">+</span> <span
                                onclick="valAdd('spc', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-spc">3</span></div>
                        <div class="substat" skill="spc">
                            <div skillid='1'>Visual Cortex<span id='sspc1'>0</span></div>
                            <div skillid='2'>Auditory System<span id='sspc2'>0</span></div>
                            <div skillid='3'>Somatosensory<span id='sspc3'>0</span></div>
                        </div>
                    </div>
                    <div class="stat">
                        <div class="title">
                            <div class="statT">MEMORY</div>
                            <div class="statV" id="mem">1</div>
                        </div>
                        <div class="tools"><span onclick="valAdd('mem')">+</span> <span
                                onclick="valAdd('mem', -1)">-</span></div>
                        <div class="point">Skill points remaining: <span id="s-mem">3</span></div>
                        <div class="substat" skill="mem">
                            <div skillid='1'>Dossier, Short Term<span id='smem1'>0</span></div>
                            <div skillid='2'>Dossier, Long Term<span id='smem2'>0</span></div>
                            <div skillid='3'>Dossier, Sensory<span id='smem3'>0</span></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <script>

            function q(m) {
                return document.querySelector(m);
            }

            var statnamearray = ["msk", "ref", "cal", "imm", "hom", "lif", "ded", "nch", "spc", "mem"];
            for (var j = 0; j < document.querySelectorAll(".tools").length; j++) {
                const apricot = statnamearray[j];
                document.querySelectorAll(".tools")[j].onmousewheel = function (e) {
                    e.preventDefault()
                    valAdd(apricot, -Math.sign(e.deltaY));
                }
            }
            for (var j = 0; j < document.querySelectorAll(".substat > div").length; j++) {
                var el = document.querySelectorAll(".substat > div")[j];
                const apricot = el.getAttribute("skillid");
                const chestnut = el.parentElement.getAttribute("skill");
                el.onmousewheel = function (e) {
                    e.preventDefault();
                    valMinorAdd(chestnut, apricot, -Math.sign(e.deltaY));
                }
                el.onclick = function (e) {
                    valMinorAdd(chestnut, apricot, -(e.button - 1));
                }
                el.oncontextmenu = function (e) {
                    e.preventDefault();
                    valMinorAdd(chestnut, apricot, -1);
                }
            }

            function GETSTORAGE() {
                return window.top.location.hash.substring(1);
            }

            var char = {
                "name": "", // todo make this functional
                "cpc": 1,
                "exp": 0,
                "statpool": 25,
                "stats": {
                    "msk": [1, 0, 0, 0, 0, 0, 0],
                    "ref": [1, 0, 0, 0, 0, 0, 0],
                    "cal": [1, 0, 0, 0, 0, 0, 0],
                    "imm": [1, 0, 0, 0, 0, 0, 0],
                    "hom": [1, 0, 0, 0, 0, 0, 0],
                    "mem": [1, 0, 0, 0, 0, 0, 0],
                    "lif": [1, 0, 0, 0, 0, 0, 0],
                    "ded": [1, 0, 0, 0, 0, 0, 0],
                    "nch": [1, 0, 0, 0, 0, 0, 0],
                    "spc": [1, 0, 0, 0, 0, 0, 0],
                }
            };
            var cavg = 1;
            var pavg = 1;

            if (GETSTORAGE() != "") {
                char = JSON.parse(atob(GETSTORAGE()));
                renderChangesComplete();
            }

            function SAVESTORAGE() {
                char.name = q("#name").innerText;
                window.top.location.hash = btoa(JSON.stringify(char));
            }

            q("#cpc").onmousewheel = function (e) {
                e.preventDefault();
                if (char.statpool - 2 * Math.sign(e.deltaY) >= 0 && char.cpc - Math.sign(e.deltaY > 0)) {
                    char.statpool -= 2 * Math.sign(e.deltaY);
                    char.cpc -= Math.sign(e.deltaY);
                }
                renderChanges();
            }
            q("#cpc").onclick = function (e) {
                char.statpool += 2;
                char.cpc += 1;
                renderChanges();
            }
            q("#cpc").oncontextmenu = function (e) {
                e.preventDefault();
                if (char.statpool - 2 >= 0 && char.cpc - 1 > 0) {
                    char.statpool -= 2;
                    char.cpc -= 1;
                    renderChanges();
                }
            }

            function calcStatpool() {
                return (pavg + cavg) * 5 + char.statpool;
            }
            function calcAvg() {
                pavg = (char.stats["msk"][0] + char.stats["ref"][0] + char.stats["cal"][0] + char.stats["imm"][0] + char.stats["hom"][0]) / 5;
                cavg = (char.stats["mem"][0] + char.stats["lif"][0] + char.stats["ded"][0] + char.stats["nch"][0] + char.stats["spc"][0]) / 5;
                q("#cavg").innerText = Math.floor(cavg);
                q("#pavg").innerText = Math.floor(pavg);
            }
            function renderChanges() {
                q("#stat").innerText = char.statpool;
                q("#health").innerText = char.stats.cal[0];
                calcAvg();
                q("#cpc").innerText = char.cpc;
                q("#activeTime").innerText = 3 / char.cpc;
            }
            function renderChangesComplete() {
                q("#name").innerText = char.name;
                renderChanges();
                for (var repeater = 0; repeater < statnamearray.length; repeater++) {
                    document.getElementById(statnamearray[repeater]).innerText = char.stats[statnamearray[repeater]][0];
                    for (var minor = 1; minor < 7; minor++) {
                        try {
                            document.getElementById("s" + statnamearray[repeater] + minor).innerText = char.stats[statnamearray[repeater]][minor];
                        }
                        catch {
                            break;
                        }
                    }
                    getSkillPool(statnamearray[repeater]);
                }
            }
            function getSkillPool(str) {
                var arr = char.stats[str];
                var sum = 0;
                arr.forEach(x => {
                    sum += x;
                });
                q("#s-" + str).innerText = arr[0] * 3 - (sum - arr[0]);
                return arr[0] * 3 - (sum - arr[0]);
            }
            function valAdd(str, add = 1) {
                var curVal = char.stats[str][0]; // get major skill value
                if (curVal + add >= 1 && char.statpool - add >= 0 && getSkillPool(str) + add * 3 > 0 && curVal + add < 11) {
                    curVal += add;
                    char.statpool -= add;
                    char.stats[str][0] = curVal; // set major skill value
                    document.getElementById(str).innerText = curVal;
                }
                SAVESTORAGE();
                getSkillPool(str);
                renderChanges();
            }
            function valMinorAdd(str, id, add = 1) {
                var curVal = char.stats[str][id]; // get skill value
                if (curVal + add >= 0 && getSkillPool(str) - add >= 0 && curVal + add < 11) {
                    curVal += add;
                    char.stats[str][id] = curVal; // set skill value
                    document.getElementById("s" + str + id).innerText = curVal;
                }
                SAVESTORAGE();
                getSkillPool(str);
                renderChanges();
            }
        </script>
    </div>

</body>


</html>
